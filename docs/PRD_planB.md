# 醫藥業務拜訪醫師門診資訊整合與週計畫系統 PRD

## 1. 產品背景與目標 (Product Background & Goals)
本產品旨在協助醫藥業務高效管理並整合分散於各大醫院的醫師門診表，透過 PWA 介面取代傳統紙本記事本，提供「目標（Target）醫師名單管理」、「門診異動追蹤」與「週計畫（Weekly Report）排程」等核心功能。

### MVP 核心產品決策：
1. **資料維護 (UGC 取代純爬蟲)**：因各大醫院門診表格式差異大防爬機制嚴格，放棄全面自動化爬蟲。改採「眾包模式 (User-Generated Content, UGC)」，允許付費業務自行上傳 PDF 門診表，系統輔助解析，結合眾人力量完善資料庫。
2. **排程衝突邏輯 (Soft Warning)**：醫藥業務拜訪時間變數高，系統防呆機制僅做到「時段重疊警告」（例如：同一天上午安排兩家不同醫院），不強制阻擋排程儲存。
3. **通知頻率 (Daily Digest)**：避免資訊疲勞，門診異動、醫師離職加入等通知，從「即時通知」改為「每日一次」的總覽推播。
4. **商業模式與權限 (All-Access MVP)**：產品定位為 B2C SaaS（向單一業務收費）。但在 MVP 階段，暫不區分免費與付費層級，所有註冊使用者皆享有完整功能，待產品上線獲得真實反饋後再引導付費牆。

## 2. 目標受眾與使用情境 (Target Audience & Use Cases)
- **目標受眾**：需要跑醫院拜訪醫生的醫藥業務。
- **主要情境**：
  - 每週一/週末：規劃下週拜訪行程，並寫入 Google Calendar。
  - 醫院現場：臨時被放鳥或醫師請假時，快速檢索該時段「同醫院/同行政區」可拜訪的替代醫師名單。
  - 睡前/出門前：確認當日「關注醫師」的門診異動總覽通知。

## 3. 系統架構與介面 (System Architecture & Interfaces)
- **前端 (PWA)**：以手機操作為主，提供接近原生的使用體驗與離線快取支援。
- **後端 (SaaS)**：使用 Supabase 提供核心登入驗證 (Google Auth) 與 Database (PostgreSQL)。
- **管理者端 (Web)**：以電腦操作為主，負責審核 UGC 任務、用戶名單與系統狀態監控。

## 4. 核心功能規格 (Core Features)

### 4.1 使用者端 MVP 核心 User Stories

#### 🎟️ Story 1: 基礎帳號與權限隔離 (Supabase Auth)
**作為一個醫藥業務**，我希望能夠使用 Google 帳號一鍵登入系統， **以便於**我能安全地保存我的關注名單與拜訪筆記，且不用擔心資料被其他業務同業看到。
* **[AC-1]** 使用者可透過 Google OAuth 授權登入 PWA。
* **[AC-2]** 資料庫配置 RLS (Row Level Security)，確保 User A 絕對無法透過 API 撈取 User B 的「關注名單」與「備忘錄」。
* **[AC-3]** 所有註冊的使用者在 MVP 階段皆預設擁有最高權限功能。

#### 🎟️ Story 2: 官方門診表維護 (Admin Data Entry - MVP)
**作為一個系統維護者**，我希望能在後台手動上傳與解析門診表 PDF， **以便於**確保 MVP 階段門診表資料的品質與結構一致性，減少早期業務使用上的資料亂象。
* **[AC-1]** 前台暫不開放一般業務上傳門診表的功能。
* **[AC-2]** 所有門診表皆由管理者從系統後台或外部工具手動匯入與建立關聯。
* **[AC-3]** 為了讓業務安心使用，前台門診表展示頁面需低調顯示「該醫院最後資料更新時間：YYYY-MM-DD」。

#### 🎟️ Story 3: 智慧尋醫與目標關注 (Targeting & Search)
**作為一個醫藥業務**，我希望能夠透過行政區或關鍵字搜尋某科別的醫師，並將他們加入「我的關注」， **以便於**我能建立專屬於我的 Target 名單，淘汰紙本記事本。
* **[AC-1]** 首頁提供搜尋吧，支援輸入「醫院名稱」、「行政區」、「科別」或「醫師姓名」。
* **[AC-2]** 醫師列表旁會有按鈕，點擊即可加入/移除「我的關注」。
* **[AC-3]** 在「我的關注」分頁中，使用者可以針對特定醫師新增 Private Notes (例如：喜歡喝無糖綠茶、不喜歡被打擾的時段)，此筆記僅自己可見。

#### 🎟️ Story 4: 彈性日曆綁定與下週排程 (Flexible Calendar Sync & Scheduling)
**作為一個醫藥業務**，我希望能在系統上綁定與解綁我的工作用 Google Calendar 帳號，並一鍵將門診時段匯入該行事曆，**以便於**我能分開管理私人帳號與工作行程，消弭門診表與行事曆之間的切換成本。
* **[AC-1] 帳號解耦與解綁功能**：系統提供「系統設定」，允許業務登入後綁定另一組專屬工作用的 Google 帳號。提供「解除綁定」按鈕，點擊後系統會立即清除伺服器端 Token 並終止雙向同步。
* **[AC-2] 獨立專屬行事曆**：系統在首度授權後，會於綁定的 Google 帳號下建立一個專屬的日曆清單（例如 `Janet Sales Calendar`），所有本系統行程預設寫入此日曆，與私人會議切分。
* **[AC-3] 一鍵排程與衝突警告 (Soft Warning)**：使用者可透過門診表一鍵加入行程；若建立的時間與原有 Google 行事曆行程重疊（同日大時段出現不同醫院），系統跳出視覺警告，但不強制阻擋。
* **[AC-4] 即時雙向同步**：本系統排程檢視畫面的異動，與 Google Calendar App 該專屬日曆保持雙向同步（例如在手機 Google 日曆刪除行程，本系統隨後也會反映刪除）。

#### 🎟️ Story 5: 每日門診異動總覽 (Daily Digest Notification)
**作為一個醫藥業務**，我希望每天早上能收到一份關於我「關注醫師」的異動總整理， **以便於**我能掌握是否有休診、代診或換科的狀況，同時不會被海量的零碎通知轟炸。
* **[AC-1]** 建立背景任務（Cron Job），每天早上彙整過去 24 小時內，該使用者「關注名單」中醫師的門診表變動。
* **[AC-2]** 若有變動，發送一則推播通知或系統內信件：「今日異動總覽：您的關注名單有更新」。
* **[AC-3]** 點擊通知後可進入專屬頁面，列出：新增的門診、取消的門診、或是超過 30 天未拜訪的關注醫師提醒。

### 4.2 後台與進階功能擴充規範 (Future Roadmap)
- 管理者介面 (Admin Web App) 用於審核 UGC 門診表與 User 管理。
- 待第一階段上線後，接入 SaaS 訂閱模組（如 Stripe），將高頻查詢與提醒功能劃分至 Premium 付費計畫。

## 5. 資料與整合邊界 (Data & Integration Boundaries)
- **Google Calendar API**：PWA 需完整授權以達到讀寫雙向同步。
- **Supabase Authentication**：強制透過 Google OAuth 解決方案進行。
- **Supabase RLS (Row Level Security)**：Target 與 Note 表格強制綁定 Auth UID。

## 6. 非功能需求 (Non-Functional Requirements)
- **Mobile First**：UI/UX 設計以 iPhone 13 尺寸與 Safari 瀏覽器為首要適配目標。
- **Offline Cache**：PWA 需支援關注清單與最近一週行程的離線存取，以便醫院網路不佳時仍可查閱。
